<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARIA SYR - Skräddarsydd sömnad i Malmö</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/index.css">
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar">
        <a href="#" class="logo">
            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='none' stroke='%23D4AF37' stroke-width='2'/><path d='M30,40 L50,65 L70,40' fill='none' stroke='%23D4AF37' stroke-width='3'/></svg>" alt="Logo">
            MARIA SYR
        </a>
        <div class="nav-links" id="navLinks">
            <a href="#home">Hem</a>
            <a href="#services">Tjänster</a>
            <a href="#products">Produkter</a>
            <a href="#pricing">Priser</a>
            <a href="#about">Om mig</a>
            <a href="#contact">Kontakt</a>
        </div>
        <button class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </nav>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <video autoplay muted loop class="hero-video" crossorigin="anonymous">
            <source src="https://assets.mixkit.co/videos/preview/mixkit-fabric-texture-close-up-118-large.mp4" type="video/mp4">
        </video>
        <div class="hero-logo">
            <img src="images/mariastrlogo.png" alt="Maria Syr Logo" width="300">
        </div>
        <h1>Skräddarsydd Sömnad i Malmö</h1>
        <p>Välkommen till MARIA SYR! Jag heter Maria Engdahl och har över 40 års erfarenhet av sömnad, design och textilt hantverk. Hos mig får du hjälp med allt från ändringar och lagningar till specialbeställningar – alltid med stor noggrannhet, kvalitet och kärlek till detaljer.</p>
        <a href="#services" class="btn">Utforska tjänster</a>
    </section>

    <!-- Services Section -->
    <section class="services" id="services">
        <h2 class="section-title">Våra Tjänster</h2>
        <div class="services-grid">
            <div class="service-card">
                <div class="gold-dust-ts"></div>
                <div class="service-icon"><i class="fas fa-cut"></i></div>
                <h3>Ändrings- och reparationssömnad</h3>
                <ul>
                    <li>Kortning/förlängning av byxor och kjolar</li>
                    <li>Omsömnad av äldre plagg</li>
                    <li>In-/utsömnad av kläder</li>
                    <li>Byta dragkedjor, knappar, laga hål</li>
                    <li>Förbättring av passform</li>
                </ul>
            </div>
            <div class="service-card">
                <div class="gold-dust-ts"></div>
                <div class="service-icon"><i class="fas fa-home"></i></div>
                <h3>Inredningstextilier</h3>
                <ul>
                    <li>Gardiner</li>
                    <li>Kuddfodral, överkast</li>
                    <li>Tygservetter</li>
                </ul>
            </div>
            <div class="service-card">
                <div class="gold-dust-ts"></div>
                <div class="service-icon"><i class="fas fa-ruler"></i></div>
                <h3>Reparationer & ändringar</h3>
                <ul>
                    <li>Laga, justera och anpassa kläder</li>
                    <li>Byte av dragkedjor</li>
                    <li>Miljövänligt och prisvärt</li>
                </ul>
            </div>
            <div class="service-card">
                <div class="gold-dust-ts"></div>
                <div class="service-icon"><i class="fas fa-ruler-combined"></i></div>
                <h3>Skräddarsydd sömnad</h3>
                <ul>
                    <li>Omsömnad av vintage-plagg</li>
                    <li>Second hand-omsömnad</li>
                    <li>Personliga lösningar</li>
                </ul>
            </div>
            <div class="service-card">
                <div class="gold-dust-ts"></div>
                <div class="service-icon"><i class="fas fa-couch"></i></div>
                <h3>Hemtextil & inredning</h3>
                <ul>
                    <li>Gardiner skräddarsydda</li>
                    <li>Kuddar och överkast</li>
                    <li>Unika hemtextilier</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- product-section -->
    <section class="products-section" id="products">
        <h2 class="section-title">Våra Produkter</h2>
        <div class="products-container">
          <% if (products && products.length > 0) { %>
            <% products.forEach(product => { %>
              <div class="product-card">
                <div class="product-image-container">
                  <% const mainImage = product.images.find(img => img.isMain) || product.images[0]; %>
                  <img src="<%= mainImage ? mainImage.url : '/images/default-product.jpg' %>" 
                       alt="<%= product.name || 'Product' %>" 
                       class="product-image">
                  <div class="fold-overlay fold-top"></div>
                  <div class="fold-overlay fold-bottom"></div>
                </div>
                <h3 class="product-name"><%= product.name || 'New Product' %></h3>
              </div>
            <% }) %>
          <% } else { %>
            <p class="no-products">Check back soon for our latest products!</p>
          <% } %>
        </div>
      </section>

    <!-- PRODUCT POPUP SECTION -->
    <div class="product-popup">
        <div class="popup-content">
            <span class="close-popup">&times;</span>
        
            <!-- Main Product Display -->
            <div class="main-product">
                <img src="" alt="" class="popup-image" style="display: none;">
                <div class="image-gallery">
                    <div class="image-gallery-container"></div>
                    <div class="image-thumbnails"></div>
                </div>
                <div class="product-details">
                <h3 class="popup-title"></h3>
                <p class="popup-description"></p>
                <a href="#contact" class="btn">Kontakta mig</a>
                </div>
            </div>
        
            <!-- Related Products -->
            <div class="related-products">
                <h4>Relaterade Produkter</h4>
                <div class="related-items-container">
                <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
        <div class="scroll-down-indicator">
            <div class="scroll-down-arrow"></div>
            <span>Scrolla nedåt</span>
        </div>
    </div>
    <!-- ================================= -->

    <!-- Pricing Section -->
    <section class="about" id="pricing">
        <div class="about-content">
            <h2 class="section-title">Prislista</h2>
            <div style="max-width: 600px; margin: 0 auto; text-align: left; background: rgba(18, 18, 18, 0.7); padding: 30px; border-radius: 10px;">
                <p><strong>Byxor/kjol:</strong> Kortning/förlängning - från 200 kr</p>
                <p><strong>Jackor/klänningar:</strong> Kortning/förlängning - från 300 kr</p>
                <p><strong>Dragkedja:</strong> Byte - från 350 kr</p>
                <p><strong>In-/utsömnad:</strong> Sidor eller axlar - från 400 kr</p>
                <p><strong>Omsömnad:</strong> Vintage/second hand - från 600 kr</p>
                <p><strong>Gardiner:</strong> Skräddarsydda - från 800 kr/m²</p>
                <p><strong>Kuddar/överkast:</strong> Specialbeställning - från 500 kr</p>
                <p class="mt-4">Alla priser är ungefärliga – kontakta mig gärna för ett kostnadsförslag.</p>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about" id="about">
        <div class="about-content">
            <h2 class="section-title">Om Maria</h2>
            <p>Jag heter Maria Engdahl och har sytt i mer än 40 år – både som passion och yrke. Min styrka ligger i noggrant hantverk, förståelse för material, och förmågan att skapa personliga lösningar.</p>
            <p>Jag tror på hållbart skapande och ser glädjen i att ge gamla plagg nytt liv eller skapa något helt från grunden. Med min erfarenhet från både små projekt och större beställningar, garanterar jag kvalitet och precision i varje stygn.</p>
            <p>Jag finns i Malmö, och du är varmt välkommen att höra av dig på email eller sms för ett personligt möte och konsultation.</p>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact" id="contact">
        <h2 class="section-title">Kontakt</h2>
        <div class="contact-container">
            <div class="contact-info">
                <h3>Kontakta mig</h3>
                <div class="contact-details">
                    <p><i class="fas fa-user"></i> Maria Engdahl</p>
                    <p><i class="fas fa-map-marker-alt"></i> Malmö, Sverige</p>
                    <p><i class="fas fa-globe"></i> www.mariasyr.com</p>
                    <p><i class="fas fa-envelope"></i> maria@mariasyr.com</p>
                    <p><i class="fas fa-phone"></i> 072-244 18 02</p>
                </div>
                <div class="social-links">
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-pinterest"></i></a>
                </div>
                <div class="mt-8">
                    <h4><i class="fas fa-clock"></i> Öppettider</h4>
                    <p>Mån-Fre: 10:00 - 18:00</p>
                    <p>Lördag: 11:00 - 15:00</p>
                    <p>Söndag: Stängt</p>
                </div>
            </div>
            <div class="contact-form">
                <form id="contactForm">
                    <input type="text" placeholder="Namn" required>
                    <input type="email" placeholder="E-post" required>
                    <input type="tel" placeholder="Telefon">
                    <textarea placeholder="Meddelande" required></textarea>
                    <button type="submit">Skicka meddelande</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-links">
            <a href="#home">Hem</a>
            <a href="#services">Tjänster</a>
            <a href="#products">Produkter</a>
            <a href="#pricing">Priser</a>
            <a href="#about">Om mig</a>
            <a href="#contact">Kontakt</a>
            <a href="#">Integritetspolicy</a>
        </div>
        <div class="copyright">
            <p>&copy; 2025 MARIA SYR. Alla rättigheter reserverade.</p>
            <p>Org.nr: 123456-7890</p>
        </div>
    </footer>


    <script>
        // Safely pass products data from backend to frontend
        window.productData = <%- JSON.stringify(products || []) %>;
        console.log('Product Data Loaded:', window.productData);
    </script>
    
    <script>
    // SINGLE DOMContentLoaded listener with all functionality
    document.addEventListener('DOMContentLoaded', function() {
        // ===== 1. NAVIGATION SCROLL EFFECT =====
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // ===== 2. MOBILE MENU =====
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');

        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            hamburger.classList.toggle('active');
            document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : 'auto';
        });

        // Close menu when clicking on links
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
                hamburger.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
        });

        // ===== 3. SMOOTH SCROLLING =====
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Close mobile menu if open
                navLinks.classList.remove('active');
                hamburger.classList.remove('active');
                document.body.style.overflow = 'auto';
                
                // Smooth scroll to target
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });

        // ===== 4. SCROLL ANIMATIONS =====
        function animateOnScroll() {
            document.querySelectorAll('.service-card, .section-title').forEach(el => {
                const position = el.getBoundingClientRect();
                if (position.top < window.innerHeight * 0.8) {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }
            });
        }
        window.addEventListener('scroll', animateOnScroll);
        animateOnScroll();

        // ===== 5. PRODUCT POPUP FUNCTIONALITY =====
        const popup = document.querySelector('.product-popup');
        const popupContent = document.querySelector('.popup-content');
        const popupImage = document.querySelector('.popup-image');
        const popupTitle = document.querySelector('.popup-title');
        const popupDescription = document.querySelector('.popup-description');
        const relatedContainer = document.querySelector('.related-items-container');
        const closePopupBtn = document.querySelector('.close-popup');
  
        // Click handler for product cards ========================
        document.querySelectorAll('.product-card').forEach((card, index) => {
            card.addEventListener('click', function(e) {
                if (e.target.closest('.related-product')) return;

                 // 1. Access the safe product data
                const products = window.productData || [];
                
                // 2. Validate product exists
                if (!products[index]) {
                    console.error('Product not found at index:', index, 'Total products:', products.length);
                    return;
                }

                const product = products[index];

                // 3. Safely access images with fallbacks
                const mainImage = (product.images && product.images.length > 0) 
                        ? product.images.find(img => img.isMain) || product.images[0] 
                        : null;
                        
                // Update popup content
                popupImage.src = mainImage?.url;                
                popupImage.alt = product.title;
                popupTitle.textContent = product.title;
                popupDescription.textContent = product.description;

                // Create image gallery
                createImageGallery(product.images || []);
                
                // Display related products
                showRelatedProducts(product.relatedIds || []);

                // Show popup
                popup.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
        });

        // Image gallery function =====================================================
        function createImageGallery(images) {
            const galleryContainer = document.querySelector('.image-gallery-container');
            const thumbnailsContainer = document.querySelector('.image-thumbnails');
            
            // Clear existing gallery
            galleryContainer.innerHTML = '';
            thumbnailsContainer.innerHTML = '';
            
            // Create main image display
            const mainImageContainer = document.createElement('div');
            mainImageContainer.className = 'main-image-container';
            
            const mainImage = document.createElement('img');
            mainImage.className = 'popup-main-image';
            mainImage.src = images[0]?.url || '/images/default-product.jpg';
            mainImage.alt = 'Main product image';
            
            mainImageContainer.appendChild(mainImage);
            galleryContainer.appendChild(mainImageContainer);
            
            // Create thumbnails if multiple images exist
            if (images.length > 1) {
                images.forEach((image, index) => {
                    const thumbnail = document.createElement('img');
                    thumbnail.src = image.url;
                    thumbnail.alt = `Thumbnail ${index + 1}`;
                    thumbnail.className = 'thumbnail';
                    if (index === 0) thumbnail.classList.add('active');
                    
                    thumbnail.addEventListener('click', () => {
                        // Update main image
                        mainImage.src = image.url;
                        // Update active thumbnail
                        document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                        thumbnail.classList.add('active');
                    });
                    
                    thumbnailsContainer.appendChild(thumbnail);
                });
            }
        }
        // ==========================================================================

        // Close popup ============================
        closePopupBtn.addEventListener('click', closePopup);
        popup.addEventListener('click', function(e) {
            if (e.target === this) closePopup();
        });

        function closePopup() {
            popup.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Show related products ============================
        function showRelatedProducts(currentProduct) {
            const relatedContainer = document.querySelector('.related-items-container');
            relatedContainer.innerHTML = '';
            
            // 1. Get products from the same category (excluding current product)
            const relatedProducts = window.productData.filter(product => 
                product.category === currentProduct.category && 
                product._id !== currentProduct._id
            );
            
            // 2. Handle no related products case
            if (relatedProducts.length === 0) {
                relatedContainer.innerHTML = '<p class="no-related">No similar products in this category</p>';
                return;
            }
            
            // 3. Limit to 4 related products
            const limitedRelatedProducts = relatedProducts.slice(0, 4);
            
            // 4. Create related items
            limitedRelatedProducts.forEach(product => {
                const mainImage = product.images?.find(img => img.isMain) || product.images?.[0];
                const imageUrl = mainImage?.url || '/images/default-product.jpg';
                
                const relatedItem = document.createElement('div');
                relatedItem.className = 'related-product';
                relatedItem.innerHTML = `
                    <img src="${imageUrl}" alt="${product.name || 'Related product'}">
                    <h5>${product.name || 'Product'}</h5>
                `;
                
                relatedItem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Update main popup with clicked related product
                    popupImage.src = imageUrl;
                    popupImage.alt = product.name;
                    popupTitle.textContent = product.name;
                    popupDescription.textContent = product.description || 'No description available';
                    // Show THIS product's related items
                    showRelatedProducts(product);
                });
                
                relatedContainer.appendChild(relatedItem);
            });
        }
        
        // SCROLL DOWN PROMPT ANIMATION
        if (popupContent) {
            popupContent.addEventListener('scroll', function() {
                // Show/hide indicator based on scroll position
                if (this.scrollTop > 20) {
                this.classList.add('scrolled');
                } else {
                this.classList.remove('scrolled');
                }
            });
        
        }

        // ===== 6. CONTACT FORM SUBMISSION =====
        const contactForm = document.getElementById('contactForm');
        if (contactForm) {
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // Simple form validation
                const name = this.querySelector('input[type="text"]').value.trim();
                const email = this.querySelector('input[type="email"]').value.trim();
                const message = this.querySelector('textarea').value.trim();
                
                if (name && email && message) {
                    // In a real implementation, you would send the data to a server
                    alert('Tack för ditt meddelande! Jag återkommer så snart som möjligt.');
                    this.reset();
                } else {
                    alert('Vänligen fyll i alla obligatoriska fält.');
                }
            });
        }

        // ===== 7. GLOBAL PARTICLES EFFECT =====
        function createParticles() {
            const particleCount = 20;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                Object.assign(particle.style, {
                    width: `${Math.random() * 5 + 1}px`,
                    height: `${Math.random() * 5 + 1}px`,
                    left: `${Math.random() * window.innerWidth}px`,
                    top: `${Math.random() * window.innerHeight}px`,
                    opacity: Math.random() * 0.5 + 0.1,
                    animation: `float ${Math.random() * 10 + 5}s infinite ease-in-out`
                });
                
                document.body.appendChild(particle);
            }
        }
        createParticles();
    });
    </script>

    <!-- JS FOR SMOOTH HORIZONTAL SCROLLING -->
    <script>
        // Add this to your existing product popup script
        document.querySelectorAll('.related-items-container').forEach(container => {
        // Enable momentum scrolling on iOS
        container.addEventListener('touchstart', function() {
            this.style.scrollBehavior = 'auto';
        });
        
        container.addEventListener('touchend', function() {
            this.style.scrollBehavior = 'smooth';
        });
        
        // Snap to items when scrolling ends
        container.addEventListener('scroll', function() {
            clearTimeout(this.scrollTimeout);
            this.scrollTimeout = setTimeout(() => {
            const scrollLeft = this.scrollLeft;
            const itemWidth = this.querySelector('.related-product').offsetWidth;
            const snappedScroll = Math.round(scrollLeft / itemWidth) * itemWidth;
            this.scrollTo({ left: snappedScroll, behavior: 'smooth' });
            }, 100);
        });
        });
    </script>
</body>
</html>